{% extends "base.html" %}

{% block title %}クイズ - {{ category.name }}{% endblock %}

{% block content %}
<main class="container mt-5" role="main">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- カテゴリ名と復習モード表示 -->
            <div class="mb-3">
                <h1 class="h4 mb-2">
                    <i class="bi bi-bookmark-fill text-primary me-2"></i>
                    {{ category.name }}
                    {% if is_review %}
                    <span class="badge bg-warning text-dark ms-2">復習モード</span>
                    {% endif %}
                </h1>
            </div>

            <!-- 進捗表示 -->
            <div class="mb-4">
                <div class="d-flex justify-content-between mb-2">
                    <span id="question-counter" aria-live="polite" aria-atomic="true">
                        問題 <span id="current-number">1</span> / <span id="total-number">{{ total_questions }}</span>
                    </span>
                    <span id="score-display" aria-live="polite" aria-atomic="true">
                        スコア: <span id="current-score">0</span>
                    </span>
                </div>
                <div class="progress" style="height: 10px;" role="progressbar" 
                     aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="進捗">
                    <div id="progress-bar" class="progress-bar" 
                         style="width: 0%;" aria-valuenow="0">
                    </div>
                </div>
            </div>

            <!-- タイマー表示 -->
            <div class="card mb-3 text-center">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock me-2"></i>残り時間
                        </h5>
                        <div>
                            <span id="timer" class="badge bg-primary fs-4" aria-live="polite" aria-atomic="true">30</span>
                            <span class="ms-2">秒</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 問題カード -->
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h2 id="question-text" class="card-title mb-4" aria-live="polite">
                        <!-- 問題文がJavaScriptで挿入されます -->
                    </h2>
                    
                    <!-- 選択肢 -->
                    <div id="options-container" class="d-grid gap-2" role="group" aria-label="選択肢">
                        <!-- 選択肢がJavaScriptで挿入されます -->
                    </div>
                </div>
            </div>

            <!-- 解説表示エリア（正解後に表示） -->
            <div id="explanation-card" class="card mt-3 d-none">
                <div class="card-body">
                    <div id="result-message" class="alert mb-3" role="alert" aria-live="polite">
                        <!-- 正解/不正解メッセージ -->
                    </div>
                    <h3 class="h5 card-title">
                        <i class="bi bi-lightbulb me-2"></i>解説
                    </h3>
                    <p id="explanation-text" class="card-text">
                        <!-- 解説文 -->
                    </p>
                    <button id="next-button" class="btn btn-primary w-100" onclick="nextQuestion()" 
                            aria-label="次の問題へ進む">
                        <i class="bi bi-arrow-right-circle me-2"></i>次の問題へ
                    </button>
                </div>
            </div>

            <!-- 設定パネル -->
            <div class="card mt-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <label for="sound-toggle" class="form-label mb-0">
                            <i class="bi bi-volume-up me-2"></i>効果音
                        </label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" 
                                   id="sound-toggle" checked 
                                   aria-label="効果音のオン・オフを切り替え">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中断ボタン -->
            <div class="text-center mt-4">
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle me-2"></i>中断して戻る
                </a>
            </div>
        </div>
    </div>
</main>

<!-- 効果音 -->
<audio id="correct-sound" preload="auto" aria-hidden="true">
    <source src="{{ url_for('static', filename='sounds/correct.mp3') }}" type="audio/mpeg">
</audio>
<audio id="incorrect-sound" preload="auto" aria-hidden="true">
    <source src="{{ url_for('static', filename='sounds/incorrect.mp3') }}" type="audio/mpeg">
</audio>

<script src="{{ url_for('static', filename='js/quiz.js') }}"></script>
{% endblock %}

