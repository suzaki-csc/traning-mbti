{% extends "base.html" %}

{% block title %}問題 {{ progress.current }}/{{ progress.total }} - クイズアプリケーション{% endblock %}

{% block extra_css %}
<style>
    .progress-item {
        width: calc(100% / {{ progress.total }});
        height: 30px;
        display: inline-block;
        border: 1px solid #ddd;
        position: relative;
    }
    .progress-item.current {
        border: 2px solid #007bff;
        font-weight: bold;
    }
    .progress-item.correct {
        background-color: #28a745;
    }
    .progress-item.incorrect {
        background-color: #dc3545;
    }
    .progress-item.pending {
        background-color: #e9ecef;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- 進捗バー -->
        <div class="mb-4">
            <div class="d-flex justify-content-between mb-2">
                <span>問題 {{ progress.current }}/{{ progress.total }}</span>
                <span id="timer-display" class="badge bg-warning text-dark">30秒</span>
            </div>
            <div class="progress-container d-flex">
                {% for i in range(progress.total) %}
                <div class="progress-item text-center {% if i < progress.current %}correct{% elif i == progress.current %}current{% else %}pending{% endif %}" 
                     style="line-height: 30px;">
                    {{ i + 1 }}
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- 問題カード -->
        <div class="card">
            <div class="card-header">
                <h3>{{ category.name }}</h3>
            </div>
            <div class="card-body">
                <h4 class="mb-4">{{ quiz.question }}</h4>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-lg answer-btn" data-answer="1">
                        1. {{ quiz.option1 }}
                    </button>
                    <button class="btn btn-outline-primary btn-lg answer-btn" data-answer="2">
                        2. {{ quiz.option2 }}
                    </button>
                    <button class="btn btn-outline-primary btn-lg answer-btn" data-answer="3">
                        3. {{ quiz.option3 }}
                    </button>
                    <button class="btn btn-outline-primary btn-lg answer-btn" data-answer="4">
                        4. {{ quiz.option4 }}
                    </button>
                </div>
            </div>
        </div>

        <!-- 効果音ON/OFF切り替え -->
        <div class="mt-3 text-end">
            <label class="form-check-label">
                <input type="checkbox" id="sound-toggle" class="form-check-input" checked>
                効果音ON
            </label>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/timer.js') }}"></script>
<script src="{{ url_for('static', filename='js/sound.js') }}"></script>
<script src="{{ url_for('static', filename='js/quiz.js') }}"></script>
<script>
    // クイズ設定
    const quizConfig = {
        categoryId: {{ category.id }},
        questionNum: {{ question_num }},
        timerSeconds: 30,
        soundEnabled: localStorage.getItem('soundEnabled') !== 'false'
    };
    
    // 効果音設定の復元
    document.getElementById('sound-toggle').checked = quizConfig.soundEnabled;
    
    // タイマー開始
    startTimer(quizConfig.timerSeconds, function() {
        // 時間切れ時の処理
        if (confirm('時間切れです。次の問題に進みますか？')) {
            window.location.href = "{{ url_for('quiz.explanation', category_id=category.id, question_num=question_num) }}";
        }
    });
</script>
{% endblock %}

