#!/bin/bash

# сѓ»сѓцсѓ║сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│УхитІЋсѓ╣сѓ»сЃфсЃЌсЃѕ

echo "=========================================="
echo "  сѓ»сѓцсѓ║сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│УхитІЋ"
echo "=========================================="
echo ""

# DockerсЂїУхитІЋсЂЌсЂдсЂёсѓІсЂІуб║УфЇ
if ! docker info > /dev/null 2>&1; then
    echo "РЮї сѓесЃЕсЃ╝: DockerсЂїУхитІЋсЂЌсЂдсЂёсЂЙсЂЏсѓЊ"
    echo "   Docker DesktopсѓњУхитІЋсЂЌсЂдсЂІсѓЅтєЇт║дт«ЪУАїсЂЌсЂдсЂЈсЂасЂЋсЂё"
    exit 1
fi

# docker-compose.ymlсЂ«тГўтюеуб║УфЇ
if [ ! -f "docker-compose.yml" ]; then
    echo "РЮї сѓесЃЕсЃ╝: docker-compose.ymlсЂїУдІсЂцсЂІсѓісЂЙсЂЏсѓЊ"
    echo "   сЃЌсЃГсѓИсѓДсѓ»сЃѕсЂ«сЃФсЃ╝сЃѕсЃЄсѓБсЃгсѓ»сЃѕсЃфсЂДт«ЪУАїсЂЌсЂдсЂЈсЂасЂЋсЂё"
    exit 1
fi

# сѓ│сЃ│сЃєсЃісѓњУхитІЋ
echo "­Ъџђ Dockerсѓ│сЃ│сЃєсЃісѓњУхитІЋсЂЌсЂдсЂёсЂЙсЂЎ..."
docker-compose up -d

if [ $? -eq 0 ]; then
    echo ""
    echo "РюЁ сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│сЂїУхитІЋсЂЌсЂЙсЂЌсЂЪ№╝Ђ"
    echo ""
    echo "=========================================="
    echo "  сѓбсѓ»сѓ╗сѓ╣ТЃЁта▒"
    echo "=========================================="
    echo "  ­Ъїљ сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│: http://localhost:5000"
    echo "  ­ЪЊі MySQL: localhost:3306"
    echo "     - сЃдсЃ╝сѓХсЃ╝: quiz_user"
    echo "     - сЃЉсѓ╣сЃ»сЃ╝сЃЅ: quiz_password"
    echo "     - сЃЄсЃ╝сѓ┐сЃЎсЃ╝сѓ╣: quiz_db"
    echo "=========================================="
    echo ""
    echo "­ЪЊЮ сЃГсѓ░сѓњуб║УфЇ: docker-compose logs -f"
    echo "­ЪЏЉ тЂюТГбТќ╣Т│Ћ: ./stop.sh сЂЙсЂЪсЂ» docker-compose down"
    echo ""
    
    # сЃќсЃЕсѓдсѓХсѓњжќІсЂЈсЂІуб║УфЇ№╝ѕmacOSсЂ«та┤тљѕ№╝Ѕ
    if [[ "$OSTYPE" == "darwin"* ]]; then
        read -p "сЃќсЃЕсѓдсѓХсЂДсѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│сѓњжќІсЂЇсЂЙсЂЎсЂІ№╝Ъ (y/N): " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            sleep 2  # сѓ│сЃ│сЃєсЃісЂ«УхитІЋсѓњтЙЁсЂц
            open http://localhost:5000
        fi
    fi
else
    echo ""
    echo "РЮї сѓесЃЕсЃ╝: сѓбсЃЌсЃфсѓ▒сЃ╝сѓисЃДсЃ│сЂ«УхитІЋсЂФтц▒ТЋЌсЂЌсЂЙсЂЌсЂЪ"
    echo "   УЕ│у┤░сѓњуб║УфЇ: docker-compose logs"
    exit 1
fi

