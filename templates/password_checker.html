{% extends "base.html" %}

{% block title %}パスワード強度チェッカー{% endblock %}

{% block extra_css %}
<style>
body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}
</style>
{% endblock %}

{% block content %}
<!-- メインコンテナ -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <!-- ヘッダー -->
            <header class="text-center mb-5">
                <h1 class="display-4 fw-bold mb-3 text-white">
                    <i class="bi bi-shield-lock-fill"></i>
                    パスワード強度チェッカー
                </h1>
                <p class="lead text-white-50">
                    パスワードの安全性をリアルタイムで評価し、<br>
                    セキュリティ向上のための具体的なアドバイスを提供します
                </p>
                
                <!-- ログイン状態表示 -->
                {% if current_user.is_authenticated %}
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-person-circle"></i> 
                        ようこそ、<strong>{{ current_user.username or current_user.email }}</strong> さん
                        {% if current_user.is_admin() %}
                            <span class="badge bg-danger ms-2">管理者</span>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="alert alert-light mt-3">
                        <i class="bi bi-info-circle"></i> 
                        <a href="{{ url_for('login') }}" class="alert-link">ログイン</a>すると、チェック履歴を保存・確認できます
                    </div>
                {% endif %}
            </header>

                <!-- メインカード -->
                <div class="card shadow-lg border-0">
                    <div class="card-body p-4 p-md-5">
                        <!-- パスワード入力セクション -->
                        <div class="mb-4">
                            <label for="passwordInput" class="form-label fw-bold">
                                パスワードを入力してください
                            </label>
                            <div class="input-group input-group-lg">
                                <!-- パスワード入力フィールド -->
                                <input 
                                    type="password" 
                                    class="form-control" 
                                    id="passwordInput" 
                                    placeholder="パスワードを入力..."
                                    aria-label="パスワード入力"
                                    aria-describedby="passwordHelp"
                                    autocomplete="off"
                                >
                                <!-- 表示/非表示トグルボタン -->
                                <button 
                                    class="btn btn-outline-secondary" 
                                    type="button" 
                                    id="togglePassword"
                                    aria-label="パスワードを表示/非表示"
                                    title="パスワードを表示/非表示"
                                >
                                    <i class="bi bi-eye" id="toggleIcon"></i>
                                </button>
                                <!-- クリップボードコピーボタン -->
                                <button 
                                    class="btn btn-outline-secondary" 
                                    type="button" 
                                    id="copyPassword"
                                    aria-label="パスワードをコピー"
                                    title="クリップボードにコピー"
                                >
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                            <div id="passwordHelp" class="form-text">
                                入力されたパスワードはサーバーに送信されません
                            </div>
                        </div>

                        <!-- 強度メーター -->
                        <div class="mb-4" id="strengthSection" style="display: none;">
                            <label class="form-label fw-bold mb-2">強度</label>
                            <div class="progress" style="height: 30px;" role="progressbar" aria-label="パスワード強度">
                                <div 
                                    class="progress-bar progress-bar-striped progress-bar-animated fw-bold" 
                                    id="strengthBar"
                                    style="width: 0%"
                                    aria-valuenow="0"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                >
                                </div>
                            </div>
                            <div class="mt-2 text-center">
                                <span class="badge fs-6" id="strengthBadge"></span>
                            </div>
                        </div>

                        <!-- 詳細情報 -->
                        <div class="mb-4" id="detailsSection" style="display: none;">
                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-info-circle"></i> 詳細情報
                            </h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="detail-card p-3 text-center">
                                        <div class="text-muted small">スコア</div>
                                        <div class="h4 mb-0 fw-bold text-primary" id="scoreValue">0</div>
                                        <div class="small text-muted">/ 100</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="detail-card p-3 text-center">
                                        <div class="text-muted small">エントロピー</div>
                                        <div class="h4 mb-0 fw-bold text-info" id="entropyValue">0</div>
                                        <div class="small text-muted">bits</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="detail-card p-3 text-center">
                                        <div class="text-muted small">想定時間</div>
                                        <div class="h6 mb-0 fw-bold text-success" id="crackTimeValue">-</div>
                                        <div class="small text-muted">総当たり攻撃</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 改善アドバイス -->
                        <div class="mb-4" id="adviceSection" style="display: none;">
                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-lightbulb"></i> 改善アドバイス
                            </h5>
                            <ul class="list-group list-group-flush" id="adviceList">
                                <!-- JavaScriptで動的に生成 -->
                            </ul>
                        </div>

                        <hr class="my-4">

                        <!-- ランダムパスワード生成 -->
                        <div>
                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-magic"></i> 安全なパスワードを生成
                            </h5>
                            <div class="text-center mb-3">
                                <button 
                                    class="btn btn-primary btn-lg" 
                                    id="generatePassword"
                                    aria-label="ランダムパスワードを生成"
                                >
                                    <i class="bi bi-arrow-clockwise"></i> パスワードを生成
                                </button>
                            </div>
                            <div id="generatedPasswords" class="mt-3">
                                <!-- JavaScriptで動的に生成 -->
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- チェック履歴 -->
                        <div>
                            <h5 class="fw-bold mb-3">
                                <i class="bi bi-clock-history"></i> 最近のチェック履歴
                            </h5>
                            <div class="d-flex justify-content-end mb-3">
                                <button class="btn btn-sm btn-outline-primary" id="refreshHistory">
                                    <i class="bi bi-arrow-clockwise"></i> 更新
                                </button>
                            </div>
                            <div id="historyList" class="mb-3">
                                <!-- JavaScriptで動的に生成 -->
                            </div>
                        </div>
                    </div>
                </div>

            <!-- フッター -->
            <footer class="mt-5 text-center text-white-50">
                <p class="small">
                    <i class="bi bi-shield-check"></i>
                    このアプリケーションは教育目的で作成されています。<br>
                    実際のパスワード管理には、パスワードマネージャーと二段階認証の使用を推奨します。
                </p>
            </footer>
        </div>
    </div>
</div>

<!-- Toast通知 -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="notificationToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong class="me-auto">通知</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="閉じる"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            <!-- メッセージが表示されます -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- カスタムJavaScript -->
<script src="{{ url_for('static', filename='js/password_checker.js') }}"></script>
{% endblock %}

