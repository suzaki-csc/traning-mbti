# MBTI診断アプリ 起動手順

## 前提条件
- Docker がインストールされていること
- Docker Compose がインストールされていること

## 起動手順

### 1. Dockerコンテナの起動

```bash
docker-compose up -d
```

コンテナが起動するまで少し待ちます（初回は数分かかります）。

### 2. データベース接続確認

データベースが完全に起動するまで待ちます（約30秒）。

```bash
docker-compose logs db
```

「ready for connections」のようなメッセージが表示されたらOKです。

### 3. データベースの初期化

```bash
docker-compose exec web python init_db.py
```

以下のようなメッセージが表示されれば成功です：
```
データベース接続成功
データベースの初期化が完了しました
- questionsテーブル: 12件のデータを投入
- diagnosis_resultsテーブル作成完了
- answersテーブル作成完了
```

### 4. アプリケーションへアクセス

ブラウザで以下のURLにアクセスします：

#### ユーザーページ
```
http://localhost:5000
```

#### 管理画面
```
http://localhost:5000/admin/login
```

**管理者ログイン情報:**
- ユーザー名: `admin`
- パスワード: `admin123`

## トラブルシューティング

### ポート5000が使用中の場合

`docker-compose.yml`のポート番号を変更します：

```yaml
services:
  web:
    ports:
      - "8080:5000"  # 5000 → 8080に変更
```

その後、`http://localhost:8080`でアクセスします。

### データベース接続エラーが発生する場合

1. コンテナをすべて停止
```bash
docker-compose down
```

2. ボリュームを削除して再起動
```bash
docker-compose down -v
docker-compose up -d
```

3. 30秒ほど待ってから再度初期化
```bash
docker-compose exec web python init_db.py
```

### ログの確認

#### アプリケーションのログ
```bash
docker-compose logs web
```

#### データベースのログ
```bash
docker-compose logs db
```

#### リアルタイムでログを確認
```bash
docker-compose logs -f
```

## 停止・削除

### コンテナの停止
```bash
docker-compose down
```

### データベースデータも含めて完全削除
```bash
docker-compose down -v
```

## 動作確認手順

### 1. ユーザー診断フロー

1. http://localhost:5000 にアクセス
2. 「診断を始める」ボタンをクリック
3. 12問の質問に回答
4. 「結果を見る」ボタンをクリック
5. MBTIタイプと各軸のスコアが表示される

### 2. 管理画面の確認

1. http://localhost:5000/admin/login にアクセス
2. admin / admin123 でログイン
3. 診断履歴一覧が表示される
4. 検索機能を試す
5. 「詳細」リンクから個別の結果を確認

## 開発モードでの起動

コードを変更しながら動作確認する場合：

```bash
docker-compose up
```

（`-d`オプションなしで起動するとログがターミナルに表示されます）

ファイルを編集すると自動的に再読み込みされます（Flask の debug モード有効）。

